<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>جنگ جهانی سوم - بازی استراتژیک</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Tahoma', 'Arial', sans-serif;
        }
        
        :root {
            --primary: #1a365d;
            --secondary: #2d3748;
            --danger: #c53030;
            --success: #38a169;
            --warning: #d69e2e;
            --info: #3182ce;
            --light: #f7fafc;
            --dark: #1a202c;
            --sidebar-width: 250px;
            --header-height: 70px;
        }
        
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Loading Page */
        #loading-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s ease;
        }
        
        .loading-logo {
            font-size: 3rem;
            color: #e2e8f0;
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .loading-logo i {
            color: #c53030;
            margin-left: 10px;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255, 255, 255, 0.1);
            border-top: 5px solid #c53030;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-message {
            font-size: 1.2rem;
            color: #94a3b8;
            margin-bottom: 20px;
        }
        
        .retry-btn {
            background: #c53030;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            display: none;
            font-size: 1rem;
            margin-top: 10px;
        }
        
        /* Login Page */
        #login-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 999;
        }
        
        .login-container {
            background: rgba(30, 41, 59, 0.9);
            padding: 2rem;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            border: 1px solid #334155;
        }
        
        .login-title {
            text-align: center;
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            color: #e2e8f0;
        }
        
        .login-title i {
            color: #c53030;
            margin-left: 10px;
        }
        
        .form-group {
            margin-bottom: 1.2rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #cbd5e0;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            background: #1e293b;
            border: 1px solid #475569;
            border-radius: 5px;
            color: #e2e8f0;
            font-size: 1rem;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #60a5fa;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 24px;
            background: #c53030;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            width: 100%;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #9b2c2c;
        }
        
        .btn-success {
            background: #38a169;
        }
        
        .btn-success:hover {
            background: #2f855a;
        }
        
        .btn-warning {
            background: #d69e2e;
        }
        
        .btn-warning:hover {
            background: #b7791f;
        }
        
        .btn-info {
            background: #3182ce;
        }
        
        .btn-info:hover {
            background: #2b6cb0;
        }
        
        .alert {
            padding: 12px;
            border-radius: 5px;
            margin-bottom: 1rem;
            display: none;
        }
        
        .alert-danger {
            background: #fed7d7;
            color: #9b2c2c;
            border: 1px solid #fc8181;
        }
        
        /* Main App */
        #app {
            display: none;
        }
        
        /* Header */
        .header {
            background: rgba(15, 23, 42, 0.9);
            height: var(--header-height);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            border-bottom: 1px solid #334155;
            position: fixed;
            top: 0;
            right: 0;
            left: 0;
            z-index: 100;
        }
        
        .header-title {
            display: flex;
            align-items: center;
            font-size: 1.5rem;
        }
        
        .header-title i {
            color: #c53030;
            margin-left: 10px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
        }
        
        .country-flag {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #4a5568;
            margin-left: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .logout-btn {
            background: transparent;
            color: #cbd5e0;
            border: 1px solid #4a5568;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
        }
        
        /* Main Layout */
        .main-container {
            display: flex;
            margin-top: var(--header-height);
            min-height: calc(100vh - var(--header-height));
        }
        
        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: rgba(15, 23, 42, 0.9);
            border-left: 1px solid #334155;
            padding: 20px 0;
            position: fixed;
            top: var(--header-height);
            right: 0;
            bottom: 0;
            overflow-y: auto;
        }
        
        .nav-menu {
            list-style: none;
        }
        
        .nav-item {
            margin-bottom: 5px;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            color: #cbd5e0;
            text-decoration: none;
            transition: background 0.3s;
        }
        
        .nav-link:hover, .nav-link.active {
            background: #1e293b;
            color: #e2e8f0;
            border-right: 3px solid #c53030;
        }
        
        .nav-link i {
            margin-left: 10px;
            width: 20px;
            text-align: center;
        }
        
        /* Content Area */
        .content {
            flex: 1;
            padding: 20px;
            margin-right: var(--sidebar-width);
            overflow-y: auto;
        }
        
        /* Dashboard Cards */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #334155;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #4a5568;
        }
        
        .card-title {
            font-size: 1.2rem;
            color: #e2e8f0;
        }
        
        .card-icon {
            font-size: 1.5rem;
            color: #c53030;
        }
        
        .card-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #e2e8f0;
        }
        
        .card-progress {
            height: 10px;
            background: #4a5568;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .card-progress-bar {
            height: 100%;
            background: #38a169;
            border-radius: 5px;
        }
        
        /* Tables */
        .table-container {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #334155;
            margin-bottom: 20px;
            overflow-x: auto;
        }
        
        .table-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: right;
            border-bottom: 1px solid #4a5568;
        }
        
        th {
            background: #1e293b;
            color: #cbd5e0;
            font-weight: bold;
        }
        
        tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: #1e293b;
            width: 90%;
            max-width: 600px;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #334155;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #4a5568;
        }
        
        .modal-title {
            font-size: 1.5rem;
            color: #e2e8f0;
        }
        
        .close-modal {
            background: transparent;
            border: none;
            color: #cbd5e0;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #4a5568;
        }
        
        /* News Feed */
        .news-feed {
            max-height: 500px;
            overflow-y: auto;
        }
        
        .news-item {
            background: rgba(45, 55, 72, 0.5);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            border-right: 4px solid #c53030;
        }
        
        .news-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .news-country {
            font-weight: bold;
            color: #e2e8f0;
        }
        
        .news-time {
            color: #94a3b8;
            font-size: 0.9rem;
        }
        
        .news-content {
            color: #cbd5e0;
            margin-bottom: 10px;
        }
        
        .news-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .news-type {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            background: #4a5568;
            color: #e2e8f0;
        }
        
        .news-type.attack {
            background: #c53030;
        }
        
        .news-type.trade {
            background: #3182ce;
        }
        
        .news-type.statement {
            background: #38a169;
        }
        
        .news-type.system {
            background: #d69e2e;
        }
        
        /* Attack Controls */
        .attack-controls {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .attack-type {
            background: rgba(45, 55, 72, 0.5);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .attack-type:hover {
            border-color: #c53030;
        }
        
        .attack-type.active {
            border-color: #c53030;
            background: rgba(197, 48, 48, 0.1);
        }
        
        .attack-type i {
            font-size: 2rem;
            color: #c53030;
            margin-bottom: 10px;
        }
        
        /* Equipment Grid */
        .equipment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .equipment-item {
            background: rgba(45, 55, 72, 0.5);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .equipment-icon {
            font-size: 2rem;
            color: #c53030;
            margin-bottom: 10px;
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .sidebar {
                width: 60px;
            }
            
            .content {
                margin-right: 60px;
            }
            
            .nav-link span {
                display: none;
            }
        }
        
        @media (max-width: 768px) {
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
            
            .header-title span {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Page -->
    <div id="loading-page">
        <div class="loading-logo">
            <i class="fas fa-crosshairs"></i>
            <span>جنگ جهانی سوم</span>
        </div>
        <div class="loading-spinner"></div>
        <div class="loading-message">در حال اتصال به سرور...</div>
        <button class="retry-btn" onclick="connectToFirestore()">تلاش مجدد</button>
    </div>

    <!-- Login Page -->
    <div id="login-page">
        <div class="login-container">
            <h2 class="login-title">
                <i class="fas fa-crosshairs"></i>
                ورود به بازی
            </h2>
            
            <div class="alert alert-danger" id="login-error">
                نام کاربری یا رمز عبور اشتباه است!
            </div>
            
            <div class="form-group">
                <label for="username">نام کاربری</label>
                <input type="text" id="username" class="form-control" placeholder="نام کاربری کشور">
            </div>
            
            <div class="form-group">
                <label for="password">رمز عبور</label>
                <input type="password" id="password" class="form-control" placeholder="رمز عبور">
            </div>
            
            <button class="btn" onclick="login()">ورود</button>
            
            <div style="margin-top: 15px; text-align: center; color: #94a3b8; font-size: 0.9rem;">
                <p>برای دسترسی ادمین:<br>یوزر: admin | پسورد: admin123</p>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="app">
        <!-- Header -->
        <header class="header">
            <div class="header-title">
                <i class="fas fa-crosshairs"></i>
                <span>جنگ جهانی سوم</span>
            </div>
            
            <div class="user-info">
                <div class="country-flag" id="country-flag">IR</div>
                <span id="country-name">ایران</span>
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    خروج
                </button>
            </div>
        </header>

        <!-- Main Container -->
        <div class="main-container">
            <!-- Sidebar -->
            <nav class="sidebar">
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="#" class="nav-link active" onclick="showSection('dashboard')">
                            <i class="fas fa-home"></i>
                            <span>داشبورد</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" onclick="showSection('equipment')">
                            <i class="fas fa-fighter-jet"></i>
                            <span>تجهیزات نظامی</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" onclick="showSection('attack')">
                            <i class="fas fa-rocket"></i>
                            <span>حمله نظامی</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" onclick="showSection('trade')">
                            <i class="fas fa-exchange-alt"></i>
                            <span>تجارت</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" onclick="showSection('black-market')">
                            <i class="fas fa-coins"></i>
                            <span>بازار سیاه</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" onclick="showSection('statement')">
                            <i class="fas fa-bullhorn"></i>
                            <span>بیانیه</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" onclick="showSection('news')">
                            <i class="fas fa-newspaper"></i>
                            <span>اخبار</span>
                        </a>
                    </li>
                    
                    <!-- Admin Only -->
                    <li class="nav-item admin-only" style="display: none;">
                        <a href="#" class="nav-link" onclick="showSection('admin-countries')">
                            <i class="fas fa-flag"></i>
                            <span>مدیریت کشورها</span>
                        </a>
                    </li>
                    <li class="nav-item admin-only" style="display: none;">
                        <a href="#" class="nav-link" onclick="showSection('admin-controls')">
                            <i class="fas fa-cogs"></i>
                            <span>کنترل سیستم</span>
                        </a>
                    </li>
                </ul>
            </nav>

            <!-- Content Area -->
            <main class="content">
                <!-- Dashboard Section -->
                <section id="dashboard-section">
                    <h2 style="margin-bottom: 20px;">داشبورد کشور</h2>
                    
                    <div class="dashboard-cards">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">اقتصاد</h3>
                                <i class="fas fa-coins card-icon"></i>
                            </div>
                            <div class="card-value" id="economy-value">52,531,511 میلیون دلار</div>
                            <div class="card-progress">
                                <div class="card-progress-bar" style="width: 85%"></div>
                            </div>
                            <div style="margin-top: 10px; font-size: 0.9rem; color: #94a3b8;">تولید: 85% ظرفیت</div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">دفاع</h3>
                                <i class="fas fa-shield-alt card-icon"></i>
                            </div>
                            <div class="card-value" id="defense-value">92%</div>
                            <div class="card-progress">
                                <div class="card-progress-bar" style="width: 92%"></div>
                            </div>
                            <div style="margin-top: 10px; font-size: 0.9rem; color: #94a3b8;">آمادگی دفاعی</div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">نیروی نظامی</h3>
                                <i class="fas fa-users card-icon"></i>
                            </div>
                            <div class="card-value" id="military-value">1,200,000 سرباز</div>
                            <div class="card-progress">
                                <div class="card-progress-bar" style="width: 70%"></div>
                            </div>
                            <div style="margin-top: 10px; font-size: 0.9rem; color: #94a3b8">فناوری: سطح 7</div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">وضعیت کشور</h3>
                                <i class="fas fa-globe card-icon"></i>
                            </div>
                            <div class="card-value" id="status-value">فعال</div>
                            <div style="margin-top: 10px; font-size: 0.9rem; color: #94a3b8;">امکان حمله و تجارت فراهم است</div>
                            <button class="btn btn-warning" style="margin-top: 15px; width: 100%;" onclick="toggleCountryStatus()">
                                تغییر وضعیت به غیرفعال
                            </button>
                        </div>
                    </div>
                    
                    <!-- Recent News -->
                    <div class="table-container">
                        <h3 class="table-title">آخرین اخبار</h3>
                        <div class="news-feed" id="recent-news">
                            <!-- News items will be loaded here -->
                        </div>
                    </div>
                </section>

                <!-- Equipment Section -->
                <section id="equipment-section" style="display: none;">
                    <h2 style="margin-bottom: 20px;">تجهیزات نظامی</h2>
                    
                    <div class="equipment-grid">
                        <div class="equipment-item">
                            <i class="fas fa-rocket equipment-icon"></i>
                            <div class="equipment-name">موشک</div>
                            <div class="equipment-count">650</div>
                        </div>
                        
                        <div class="equipment-item">
                            <i class="fas fa-fighter-jet equipment-icon"></i>
                            <div class="equipment-name">جنگنده</div>
                            <div class="equipment-count">266</div>
                        </div>
                        
                        <div class="equipment-item">
                            <i class="fas fa-plane equipment-icon"></i>
                            <div class="equipment-name">بمب‌افکن</div>
                            <div class="equipment-count">241</div>
                        </div>
                        
                        <div class="equipment-item">
                            <i class="fas fa-tank equipment-icon"></i>
                            <div class="equipment-name">تانک</div>
                            <div class="equipment-count">1953</div>
                        </div>
                        
                        <div class="equipment-item">
                            <i class="fas fa-ship equipment-icon"></i>
                            <div class="equipment-name">ناو جنگی</div>
                            <div class="equipment-count">150</div>
                        </div>
                        
                        <div class="equipment-item">
                            <i class="fas fa-shield-alt equipment-icon"></i>
                            <div class="equipment-name">پدافند</div>
                            <div class="equipment-count">730,000</div>
                        </div>
                        
                        <div class="equipment-item">
                            <i class="fas fa-user-shield equipment-icon"></i>
                            <div class="equipment-name">سرباز</div>
                            <div class="equipment-count">1,200,000</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <button class="btn btn-info" onclick="showBlackMarket()">
                            <i class="fas fa-shopping-cart"></i>
                            خرید از بازار سیاه
                        </button>
                    </div>
                </section>

                <!-- Attack Section -->
                <section id="attack-section" style="display: none;">
                    <h2 style="margin-bottom: 20px;">حمله نظامی</h2>
                    
                    <div class="attack-controls">
                        <div class="attack-type active" onclick="selectAttackType('air')">
                            <i class="fas fa-fighter-jet"></i>
                            <div>حمله هوایی</div>
                            <div style="font-size: 0.9rem; color: #94a3b8; margin-top: 5px;">استفاده از جنگنده و بمب‌افکن</div>
                        </div>
                        
                        <div class="attack-type" onclick="selectAttackType('ground')">
                            <i class="fas fa-tank"></i>
                            <div>حمله زمینی</div>
                            <div style="font-size: 0.9rem; color: #94a3b8; margin-top: 5px;">استفاده از تانک و سرباز</div>
                        </div>
                        
                        <div class="attack-type" onclick="selectAttackType('naval')">
                            <i class="fas fa-ship"></i>
                            <div>حمله دریایی</div>
                            <div style="font-size: 0.9rem; color: #94a3b8; margin-top: 5px;">استفاده از ناو جنگی</div>
                        </div>
                        
                        <div class="attack-type" onclick="selectAttackType('missile')">
                            <i class="fas fa-rocket"></i>
                            <div>حمله موشکی</div>
                            <div style="font-size: 0.9rem; color: #94a3b8; margin-top: 5px;">استفاده از موشک‌های دوربرد</div>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <h3 class="table-title">انتخاب کشور هدف</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>کشور</th>
                                    <th>قدرت دفاعی</th>
                                    <th>وضعیت</th>
                                    <th>عملیات</th>
                                </tr>
                            </thead>
                            <tbody id="target-countries">
                                <!-- Target countries will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="table-container" id="attack-details" style="display: none;">
                        <h3 class="table-title">جزئیات حمله</h3>
                        <div id="attack-summary"></div>
                        <div class="modal-footer">
                            <button class="btn" onclick="executeAttack()">تأیید و اجرای حمله</button>
                            <button class="btn btn-warning" onclick="cancelAttack()">لغو</button>
                        </div>
                    </div>
                </section>

                <!-- Trade Section -->
                <section id="trade-section" style="display: none;">
                    <h2 style="margin-bottom: 20px;">تجارت با کشورها</h2>
                    
                    <div class="table-container">
                        <h3 class="table-title">کشورهای قابل تجارت</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>کشور</th>
                                    <th>وضعیت اقتصادی</th>
                                    <th>امکانات</th>
                                    <th>عملیات</th>
                                </tr>
                            </thead>
                            <tbody id="trade-countries">
                                <!-- Trade countries will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Black Market Section -->
                <section id="black-market-section" style="display: none;">
                    <h2 style="margin-bottom: 20px;">بازار سیاه</h2>
                    
                    <div class="table-container">
                        <h3 class="table-title">لیست تجهیزات قابل خرید</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>تجهیزات</th>
                                    <th>قیمت (میلیون دلار)</th>
                                    <th>موجودی شما</th>
                                    <th>عملیات</th>
                                </tr>
                            </thead>
                            <tbody id="black-market-items">
                                <!-- Black market items will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Statement Section -->
                <section id="statement-section" style="display: none;">
                    <h2 style="margin-bottom: 20px;">صدور بیانیه</h2>
                    
                    <div class="table-container">
                        <div class="form-group">
                            <label for="statement-title">عنوان بیانیه</label>
                            <input type="text" id="statement-title" class="form-control" placeholder="عنوان بیانیه">
                        </div>
                        
                        <div class="form-group">
                            <label for="statement-content">متن بیانیه</label>
                            <textarea id="statement-content" class="form-control" rows="5" placeholder="متن کامل بیانیه"></textarea>
                        </div>
                        
                        <button class="btn btn-success" onclick="publishStatement()">
                            <i class="fas fa-paper-plane"></i>
                            انتشار بیانیه
                        </button>
                    </div>
                </section>

                <!-- News Section -->
                <section id="news-section" style="display: none;">
                    <h2 style="margin-bottom: 20px;">اخبار و رویدادها</h2>
                    
                    <div class="table-container">
                        <h3 class="table-title">همه اخبار
                            <button class="btn btn-warning btn-sm" onclick="clearMyStatements()" style="font-size: 0.8rem; padding: 5px 10px;">
                                حذف بیانیه‌های من
                            </button>
                        </h3>
                        <div class="news-feed" id="all-news">
                            <!-- All news will be loaded here -->
                        </div>
                    </div>
                </section>

                <!-- Admin Countries Section -->
                <section id="admin-countries-section" style="display: none;">
                    <h2 style="margin-bottom: 20px;">مدیریت کشورها (ادمین)</h2>
                    
                    <div style="margin-bottom: 20px;">
                        <button class="btn btn-success" onclick="showAddCountryModal()">
                            <i class="fas fa-plus"></i>
                            افزودن کشور جدید
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <h3 class="table-title">لیست کشورها</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>کشور</th>
                                    <th>یوزرنیم</th>
                                    <th>اقتصاد</th>
                                    <th>دفاع</th>
                                    <th>فناوری</th>
                                    <th>عملیات</th>
                                </tr>
                            </thead>
                            <tbody id="admin-countries-list">
                                <!-- Countries list for admin will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Admin Controls Section -->
                <section id="admin-controls-section" style="display: none;">
                    <h2 style="margin-bottom: 20px;">کنترل سیستم (ادمین)</h2>
                    
                    <div class="dashboard-cards">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">کنترل سیستم</h3>
                                <i class="fas fa-power-off card-icon"></i>
                            </div>
                            <div class="card-value" id="system-status">فعال</div>
                            <div style="margin-top: 10px;">
                                <button class="btn btn-warning" style="width: 100%;" onclick="toggleSystemStatus()">
                                    غیرفعال کردن سیستم
                                </button>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">پیام سیستم</h3>
                                <i class="fas fa-bullhorn card-icon"></i>
                            </div>
                            <div class="form-group" style="margin-top: 15px;">
                                <textarea id="system-message" class="form-control" rows="3" placeholder="پیام سیستم"></textarea>
                            </div>
                            <button class="btn btn-info" style="width: 100%; margin-top: 10px;" onclick="sendSystemMessage()">
                                ارسال پیام
                            </button>
                        </div>
                    </div>
                </section>
            </main>
        </div>

        <!-- Modals -->
        <!-- Attack Modal -->
        <div id="attack-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">جزئیات حمله</h3>
                    <button class="close-modal" onclick="closeModal('attack-modal')">&times;</button>
                </div>
                <div id="attack-modal-content">
                    <!-- Attack details will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Trade Modal -->
        <div id="trade-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">ارسال درخواست تجارت</h3>
                    <button class="close-modal" onclick="closeModal('trade-modal')">&times;</button>
                </div>
                <div id="trade-modal-content">
                    <!-- Trade details will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Black Market Modal -->
        <div id="black-market-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">خرید از بازار سیاه</h3>
                    <button class="close-modal" onclick="closeModal('black-market-modal')">&times;</button>
                </div>
                <div id="black-market-modal-content">
                    <!-- Black market purchase details will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Add Country Modal (Admin) -->
        <div id="add-country-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">افزودن کشور جدید</h3>
                    <button class="close-modal" onclick="closeModal('add-country-modal')">&times;</button>
                </div>
                <div id="add-country-modal-content">
                    <div class="form-group">
                        <label for="new-country-name">نام کشور</label>
                        <input type="text" id="new-country-name" class="form-control" placeholder="نام کشور">
                    </div>
                    
                    <div class="form-group">
                        <label for="new-country-username">نام کاربری</label>
                        <input type="text" id="new-country-username" class="form-control" placeholder="نام کاربری">
                    </div>
                    
                    <div class="form-group">
                        <label for="new-country-password">رمز عبور</label>
                        <input type="password" id="new-country-password" class="form-control" placeholder="رمز عبور">
                    </div>
                    
                    <div class="form-group">
                        <label for="new-country-economy">اقتصاد اولیه (میلیون دلار)</label>
                        <input type="number" id="new-country-economy" class="form-control" value="1000000">
                    </div>
                    
                    <div class="form-group">
                        <label for="new-country-defense">درصد دفاع اولیه</label>
                        <input type="number" id="new-country-defense" class="form-control" min="0" max="100" value="50">
                    </div>
                    
                    <div class="form-group">
                        <label for="new-country-technology">سطح فناوری اولیه</label>
                        <input type="number" id="new-country-technology" class="form-control" min="1" max="10" value="3">
                    </div>
                    
                    <div class="modal-footer">
                        <button class="btn btn-success" onclick="addNewCountry()">افزودن کشور</button>
                        <button class="btn btn-warning" onclick="closeModal('add-country-modal')">لغو</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Country Modal (Admin) -->
        <div id="edit-country-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">ویرایش کشور</h3>
                    <button class="close-modal" onclick="closeModal('edit-country-modal')">&times;</button>
                </div>
                <div id="edit-country-modal-content">
                    <!-- Edit country form will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDEXAMPLEEXAMPLEEXAMPLEEXAMPLE",
            authDomain: "world-war-iii-game.firebaseapp.com",
            projectId: "world-war-iii-game",
            storageBucket: "world-war-iii-game.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef1234567890abcdef"
        };

        // Initialize Firebase
        let firebaseApp;
        let db;
        
        // Game State
        let currentUser = null;
        let currentCountry = null;
        let isAdmin = false;
        let gameActive = true;
        let selectedAttackType = 'air';
        let selectedTargetCountry = null;
        let selectedEquipment = {};
        
        // Initialize the game
        function initGame() {
            // Simulate Firestore connection
            setTimeout(() => {
                // If connection successful
                const success = Math.random() > 0.2; // 80% success rate for simulation
                
                if (success) {
                    // Hide loading page, show login page
                    document.getElementById('loading-page').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('loading-page').style.display = 'none';
                        document.getElementById('login-page').style.display = 'flex';
                    }, 500);
                    
                    // Initialize fake database for demo
                    initFakeDatabase();
                } else {
                    // Show retry button
                    document.querySelector('.loading-message').textContent = 'اتصال به سرور ناموفق بود!';
                    document.querySelector('.retry-btn').style.display = 'block';
                }
            }, 2000);
        }
        
        // Connect to Firestore (simulated)
        function connectToFirestore() {
            document.querySelector('.loading-message').textContent = 'در حال اتصال به سرور...';
            document.querySelector('.retry-btn').style.display = 'none';
            
            setTimeout(() => {
                document.getElementById('loading-page').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loading-page').style.display = 'none';
                    document.getElementById('login-page').style.display = 'flex';
                }, 500);
                
                // Initialize fake database for demo
                initFakeDatabase();
            }, 1500);
        }
        
        // Initialize fake database for demo purposes
        function initFakeDatabase() {
            // This would be replaced with actual Firestore initialization
            console.log("Firestore connected (simulated)");
            
            // Sample data for demo
            window.countries = [
                {
                    id: 1,
                    name: "ایران",
                    username: "iran",
                    password: "iran123",
                    economy: 52531511,
                    defense: 92,
                    technology: 7,
                    equipment: {
                        missiles: 650,
                        fighters: 266,
                        bombers: 241,
                        tanks: 1953,
                        warships: 150,
                        airDefense: 730000,
                        soldiers: 1200000
                    },
                    active: true,
                    production: 85
                },
                {
                    id: 2,
                    name: "آمریکا",
                    username: "usa",
                    password: "usa123",
                    economy: 250000000,
                    defense: 95,
                    technology: 10,
                    equipment: {
                        missiles: 5000,
                        fighters: 2000,
                        bombers: 150,
                        tanks: 6000,
                        warships: 400,
                        airDefense: 1500000,
                        soldiers: 1500000
                    },
                    active: true,
                    production: 90
                },
                {
                    id: 3,
                    name: "چین",
                    username: "china",
                    password: "china123",
                    economy: 180000000,
                    defense: 88,
                    technology: 9,
                    equipment: {
                        missiles: 3500,
                        fighters: 1500,
                        bombers: 200,
                        tanks: 10000,
                        warships: 350,
                        airDefense: 1200000,
                        soldiers: 2500000
                    },
                    active: true,
                    production: 85
                },
                {
                    id: 4,
                    name: "روسیه",
                    username: "russia",
                    password: "russia123",
                    economy: 160000000,
                    defense: 90,
                    technology: 8,
                    equipment: {
                        missiles: 4000,
                        fighters: 1200,
                        bombers: 180,
                        tanks: 15000,
                        warships: 300,
                        airDefense: 1000000,
                        soldiers: 1000000
                    },
                    active: true,
                    production: 80
                }
            ];
            
            window.news = [
                {
                    id: 1,
                    type: "system",
                    country: "سیستم",
                    title: "خوش آمدید",
                    content: "به بازی جنگ جهانی سوم خوش آمدید. وضعیت سیستم فعال است.",
                    time: "۲ ساعت پیش"
                },
                {
                    id: 2,
                    type: "statement",
                    country: "آمریکا",
                    title: "بیانیه آمریکا",
                    content: "آمریکا از مواضع خود در قبال تحولات منطقه دفاع می‌کند.",
                    time: "۴ ساعت پیش"
                },
                {
                    id: 3,
                    type: "attack",
                    country: "روسیه",
                    title: "حمله هوایی",
                    content: "روسیه به اوکراین حمله هوایی کرد. تلفات: ۱۰ جنگنده روسیه، ۱۵ جنگنده اوکراین",
                    time: "۶ ساعت پیش"
                },
                {
                    id: 4,
                    type: "trade",
                    country: "چین",
                    title: "تجارت موفق",
                    content: "چین با ایران تجارت ۱۰۰ موشک در برابر ۵۰۰۰ میلیون دلار انجام داد.",
                    time: "۱ روز پیش"
                }
            ];
            
            window.blackMarketItems = [
                { id: 1, name: "موشک", price: 50, unit: "عدد" },
                { id: 2, name: "جنگنده", price: 150, unit: "فروند" },
                { id: 3, name: "تانک", price: 10, unit: "دستگاه" },
                { id: 4, name: "ناو جنگی", price: 500, unit: "فروند" },
                { id: 5, name: "سرباز", price: 0.1, unit: "هزار نفر" }
            ];
        }
        
        // Login function
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Clear previous error
            document.getElementById('login-error').style.display = 'none';
            
            // Check for admin login
            if (username === 'admin' && password === 'admin123') {
                currentUser = { username: 'admin', isAdmin: true };
                isAdmin = true;
                currentCountry = null;
                loadAdminPanel();
                return;
            }
            
            // Check for country login
            const country = window.countries.find(c => c.username === username && c.password === password);
            
            if (country) {
                currentUser = { username: country.username, isAdmin: false };
                currentCountry = country;
                isAdmin = false;
                loadPlayerPanel();
            } else {
                // Show error
                document.getElementById('login-error').style.display = 'block';
            }
        }
        
        // Load admin panel
        function loadAdminPanel() {
            // Hide login, show app
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            
            // Set admin UI
            document.getElementById('country-name').textContent = "مدیر سیستم";
            document.getElementById('country-flag').textContent = "AD";
            document.getElementById('country-flag').style.background = "#c53030";
            
            // Show admin menu items
            document.querySelectorAll('.admin-only').forEach(el => {
                el.style.display = 'block';
            });
            
            // Load admin data
            showSection('dashboard');
            loadAdminCountries();
            loadRecentNews();
            
            // Update system status
            document.getElementById('system-status').textContent = gameActive ? "فعال" : "غیرفعال";
            document.getElementById('status-value').textContent = "مدیر سیستم";
        }
        
        // Load player panel
        function loadPlayerPanel() {
            // Hide login, show app
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            
            // Set player UI
            document.getElementById('country-name').textContent = currentCountry.name;
            document.getElementById('country-flag').textContent = currentCountry.name.substring(0, 2).toUpperCase();
            
            // Hide admin menu items
            document.querySelectorAll('.admin-only').forEach(el => {
                el.style.display = 'none';
            });
            
            // Load player data
            showSection('dashboard');
            updateDashboard();
            loadRecentNews();
            loadTargetCountries();
            loadTradeCountries();
            loadBlackMarketItems();
            
            // Update status
            document.getElementById('status-value').textContent = currentCountry.active ? "فعال" : "غیرفعال";
            document.querySelector('#dashboard-section .btn-warning').textContent = 
                currentCountry.active ? "تغییر وضعیت به غیرفعال" : "تغییر وضعیت به فعال";
        }
        
        // Logout function
        function logout() {
            currentUser = null;
            currentCountry = null;
            isAdmin = false;
            
            // Hide app, show login
            document.getElementById('app').style.display = 'none';
            document.getElementById('login-page').style.display = 'flex';
            
            // Clear login form
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('login-error').style.display = 'none';
        }
        
        // Show section function
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('main section').forEach(section => {
                section.style.display = 'none';
            });
            
            // Show selected section
            document.getElementById(`${sectionId}-section`).style.display = 'block';
            
            // Update active nav link
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Find and activate the corresponding nav link
            let navLink;
            if (sectionId === 'dashboard') navLink = document.querySelector('.nav-link[onclick*="dashboard"]');
            else if (sectionId === 'equipment') navLink = document.querySelector('.nav-link[onclick*="equipment"]');
            else if (sectionId === 'attack') navLink = document.querySelector('.nav-link[onclick*="attack"]');
            else if (sectionId === 'trade') navLink = document.querySelector('.nav-link[onclick*="trade"]');
            else if (sectionId === 'black-market') navLink = document.querySelector('.nav-link[onclick*="black-market"]');
            else if (sectionId === 'statement') navLink = document.querySelector('.nav-link[onclick*="statement"]');
            else if (sectionId === 'news') navLink = document.querySelector('.nav-link[onclick*="news"]');
            else if (sectionId === 'admin-countries') navLink = document.querySelector('.nav-link[onclick*="admin-countries"]');
            else if (sectionId === 'admin-controls') navLink = document.querySelector('.nav-link[onclick*="admin-controls"]');
            
            if (navLink) navLink.classList.add('active');
        }
        
        // Update dashboard
        function updateDashboard() {
            if (!currentCountry) return;
            
            document.getElementById('economy-value').textContent = 
                `${currentCountry.economy.toLocaleString()} میلیون دلار`;
            
            document.getElementById('defense-value').textContent = 
                `${currentCountry.defense}%`;
            
            document.getElementById('military-value').textContent = 
                `${currentCountry.equipment.soldiers.toLocaleString()} سرباز`;
            
            document.querySelector('#dashboard-section .card-progress-bar').style.width = 
                `${currentCountry.production}%`;
        }
        
        // Load recent news
        function loadRecentNews() {
            const newsContainer = document.getElementById('recent-news');
            const allNewsContainer = document.getElementById('all-news');
            
            if (!newsContainer || !allNewsContainer) return;
            
            newsContainer.innerHTML = '';
            allNewsContainer.innerHTML = '';
            
            window.news.forEach(item => {
                const newsItem = document.createElement('div');
                newsItem.className = 'news-item';
                
                const typeClass = `news-type ${item.type}`;
                
                newsItem.innerHTML = `
                    <div class="news-header">
                        <div class="news-country">${item.country}</div>
                        <div class="news-time">${item.time}</div>
                    </div>
                    <div class="news-content">
                        <strong>${item.title}</strong><br>
                        ${item.content}
                    </div>
                    <div class="news-footer">
                        <span class="${typeClass}">${getNewsTypeText(item.type)}</span>
                        ${item.country === currentCountry?.name || isAdmin ? 
                          `<button class="btn btn-danger btn-sm" onclick="deleteNews(${item.id})" style="padding: 3px 8px; font-size: 0.8rem;">حذف</button>` : 
                          ''}
                    </div>
                `;
                
                newsContainer.appendChild(newsItem.cloneNode(true));
                allNewsContainer.appendChild(newsItem);
            });
        }
        
        // Get news type text
        function getNewsTypeText(type) {
            const types = {
                'system': 'سیستم',
                'statement': 'بیانیه',
                'attack': 'حمله',
                'trade': 'تجارت'
            };
            
            return types[type] || type;
        }
        
        // Load target countries for attack
        function loadTargetCountries() {
            const container = document.getElementById('target-countries');
            if (!container) return;
            
            container.innerHTML = '';
            
            window.countries.forEach(country => {
                if (country.id === currentCountry.id) return;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${country.name}</td>
                    <td>${country.defense}%</td>
                    <td>${country.active ? 'فعال' : 'غیرفعال'}</td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="prepareAttack(${country.id})" ${!country.active ? 'disabled' : ''}>
                            حمله
                        </button>
                    </td>
                `;
                
                container.appendChild(row);
            });
        }
        
        // Load trade countries
        function loadTradeCountries() {
            const container = document.getElementById('trade-countries');
            if (!container) return;
            
            container.innerHTML = '';
            
            window.countries.forEach(country => {
                if (country.id === currentCountry.id) return;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${country.name}</td>
                    <td>${country.economy.toLocaleString()} میلیون دلار</td>
                    <td>${country.equipment.missiles} موشک، ${country.equipment.fighters} جنگنده</td>
                    <td>
                        <button class="btn btn-info btn-sm" onclick="prepareTrade(${country.id})" ${!country.active ? 'disabled' : ''}>
                            تجارت
                        </button>
                    </td>
                `;
                
                container.appendChild(row);
            });
        }
        
        // Load black market items
        function loadBlackMarketItems() {
            const container = document.getElementById('black-market-items');
            if (!container) return;
            
            container.innerHTML = '';
            
            window.blackMarketItems.forEach(item => {
                const row = document.createElement('tr');
                
                // Get current equipment count
                let currentCount = 0;
                if (item.name === "موشک") currentCount = currentCountry.equipment.missiles;
                else if (item.name === "جنگنده") currentCount = currentCountry.equipment.fighters;
                else if (item.name === "تانک") currentCount = currentCountry.equipment.tanks;
                else if (item.name === "ناو جنگی") currentCount = currentCountry.equipment.warships;
                else if (item.name === "سرباز") currentCount = currentCountry.equipment.soldiers / 1000;
                
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.price.toLocaleString()}</td>
                    <td>${currentCount.toLocaleString()} ${item.unit}</td>
                    <td>
                        <button class="btn btn-warning btn-sm" onclick="buyFromBlackMarket(${item.id})">
                            خرید
                        </button>
                    </td>
                `;
                
                container.appendChild(row);
            });
        }
        
        // Select attack type
        function selectAttackType(type) {
            selectedAttackType = type;
            
            // Update UI
            document.querySelectorAll('.attack-type').forEach(el => {
                el.classList.remove('active');
            });
            
            event.currentTarget.classList.add('active');
        }
        
        // Prepare attack
        function prepareAttack(countryId) {
            selectedTargetCountry = window.countries.find(c => c.id === countryId);
            
            // Show attack details
            document.getElementById('attack-details').style.display = 'block';
            
            const summary = document.getElementById('attack-summary');
            summary.innerHTML = `
                <p><strong>کشور هدف:</strong> ${selectedTargetCountry.name}</p>
                <p><strong>نوع حمله:</strong> ${getAttackTypeText(selectedAttackType)}</p>
                <p><strong>قدرت دفاعی هدف:</strong> ${selectedTargetCountry.defense}%</p>
                <p><strong>هشدار:</strong> در صورت فعال بودن پدافند کشور هدف، تلفات شما بیشتر خواهد بود.</p>
                
                <div class="form-group" style="margin-top: 15px;">
                    <label for="attack-force">تعداد نیروی حمله‌کننده</label>
                    <input type="number" id="attack-force" class="form-control" value="100" min="10" max="1000">
                </div>
            `;
            
            // Scroll to attack details
            document.getElementById('attack-details').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Get attack type text
        function getAttackTypeText(type) {
            const types = {
                'air': 'حمله هوایی',
                'ground': 'حمله زمینی',
                'naval': 'حمله دریایی',
                'missile': 'حمله موشکی'
            };
            
            return types[type] || type;
        }
        
        // Execute attack
        function executeAttack() {
            if (!selectedTargetCountry) return;
            
            const attackForce = parseInt(document.getElementById('attack-force').value) || 100;
            
            // Check if player has enough equipment
            let hasEnough = false;
            let equipmentType = '';
            
            switch(selectedAttackType) {
                case 'air':
                    hasEnough = currentCountry.equipment.fighters >= attackForce;
                    equipmentType = 'جنگنده';
                    break;
                case 'missile':
                    hasEnough = currentCountry.equipment.missiles >= attackForce;
                    equipmentType = 'موشک';
                    break;
                case 'ground':
                    hasEnough = currentCountry.equipment.tanks >= attackForce;
                    equipmentType = 'تانک';
                    break;
                case 'naval':
                    hasEnough = currentCountry.equipment.warships >= attackForce;
                    equipmentType = 'ناو جنگی';
                    break;
            }
            
            if (!hasEnough) {
                alert(`تجهیزات کافی ندارید! شما ${equipmentType} کافی برای این حمله ندارید.`);
                return;
            }
            
            // Calculate battle results
            const attackerLoss = Math.floor(attackForce * (0.1 + Math.random() * 0.3));
            const defenderLoss = Math.floor(attackForce * (0.2 + Math.random() * 0.4));
            
            // Apply defense reduction
            const defenseFactor = selectedTargetCountry.defense / 100;
            const actualDefenderLoss = Math.floor(defenderLoss * (1 - defenseFactor));
            
            // Update equipment
            switch(selectedAttackType) {
                case 'air':
                    currentCountry.equipment.fighters -= attackerLoss;
                    selectedTargetCountry.equipment.fighters -= actualDefenderLoss;
                    break;
                case 'missile':
                    currentCountry.equipment.missiles -= attackerLoss;
                    selectedTargetCountry.equipment.missiles -= actualDefenderLoss;
                    break;
                case 'ground':
                    currentCountry.equipment.tanks -= attackerLoss;
                    selectedTargetCountry.equipment.tanks -= actualDefenderLoss;
                    break;
                case 'naval':
                    currentCountry.equipment.warships -= attackerLoss;
                    selectedTargetCountry.equipment.warships -= actualDefenderLoss;
                    break;
            }
            
            // Add news
            const newNews = {
                id: window.news.length + 1,
                type: "attack",
                country: currentCountry.name,
                title: `حمله ${getAttackTypeText(selectedAttackType)}`,
                content: `${currentCountry.name} به ${selectedTargetCountry.name} حمله ${getAttackTypeText(selectedAttackType)} کرد. تلفات کشور هدف: ${actualDefenderLoss} ${equipmentType}، تلفات کشور مهاجم: ${attackerLoss} ${equipmentType}`,
                time: "همین الان"
            };
            
            window.news.unshift(newNews);
            
            // Update UI
            updateDashboard();
            loadRecentNews();
            
            // Show success message
            alert(`حمله با موفقیت انجام شد! تلفات شما: ${attackerLoss}، تلفات دشمن: ${actualDefenderLoss}`);
            
            // Reset attack
            cancelAttack();
        }
        
        // Cancel attack
        function cancelAttack() {
            selectedTargetCountry = null;
            document.getElementById('attack-details').style.display = 'none';
        }
        
        // Prepare trade
        function prepareTrade(countryId) {
            const targetCountry = window.countries.find(c => c.id === countryId);
            
            // Show trade modal
            const modalContent = document.getElementById('trade-modal-content');
            modalContent.innerHTML = `
                <p><strong>کشور مقصد:</strong> ${targetCountry.name}</p>
                
                <div class="form-group">
                    <label for="trade-give-item">آنچه می‌دهید</label>
                    <select id="trade-give-item" class="form-control" onchange="updateTradeValues()">
                        <option value="money">پول (میلیون دلار)</option>
                        <option value="missiles">موشک</option>
                        <option value="fighters">جنگنده</option>
                        <option value="tanks">تانک</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="trade-give-amount">مقدار</label>
                    <input type="number" id="trade-give-amount" class="form-control" value="100" min="1" oninput="updateTradeValues()">
                </div>
                
                <div class="form-group">
                    <label for="trade-get-item">آنچه می‌گیرید</label>
                    <select id="trade-get-item" class="form-control" onchange="updateTradeValues()">
                        <option value="missiles">موشک</option>
                        <option value="fighters">جنگنده</option>
                        <option value="tanks">تانک</option>
                        <option value="money">پول (میلیون دلار)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="trade-get-amount">مقدار</label>
                    <input type="number" id="trade-get-amount" class="form-control" value="10" min="1" readonly>
                </div>
                
                <div class="modal-footer">
                    <button class="btn btn-success" onclick="sendTradeRequest(${countryId})">ارسال درخواست تجارت</button>
                    <button class="btn btn-warning" onclick="closeModal('trade-modal')">لغو</button>
                </div>
            `;
            
            openModal('trade-modal');
            updateTradeValues();
        }
        
        // Update trade values
        function updateTradeValues() {
            // Simple conversion rates for demo
            const giveItem = document.getElementById('trade-give-item').value;
            const giveAmount = parseInt(document.getElementById('trade-give-amount').value) || 100;
            const getItem = document.getElementById('trade-get-item').value;
            
            // Prevent same item trade
            if (giveItem === getItem) {
                document.getElementById('trade-get-item').value = giveItem === 'money' ? 'missiles' : 'money';
                updateTradeValues();
                return;
            }
            
            let getAmount = 0;
            
            // Conversion rates (simplified for demo)
            if (giveItem === 'money') {
                if (getItem === 'missiles') getAmount = Math.floor(giveAmount / 5);
                else if (getItem === 'fighters') getAmount = Math.floor(giveAmount / 50);
                else if (getItem === 'tanks') getAmount = Math.floor(giveAmount / 2);
            } else if (giveItem === 'missiles') {
                if (getItem === 'money') getAmount = giveAmount * 5;
                else if (getItem === 'fighters') getAmount = Math.floor(giveAmount / 10);
                else if (getItem === 'tanks') getAmount = giveAmount * 2;
            } else if (giveItem === 'fighters') {
                if (getItem === 'money') getAmount = giveAmount * 50;
                else if (getItem === 'missiles') getAmount = giveAmount * 10;
                else if (getItem === 'tanks') getAmount = giveAmount * 5;
            } else if (giveItem === 'tanks') {
                if (getItem === 'money') getAmount = giveAmount * 2;
                else if (getItem === 'missiles') getAmount = Math.floor(giveAmount / 2);
                else if (getItem === 'fighters') getAmount = Math.floor(giveAmount / 5);
            }
            
            document.getElementById('trade-get-amount').value = getAmount;
        }
        
        // Send trade request
        function sendTradeRequest(countryId) {
            const targetCountry = window.countries.find(c => c.id === countryId);
            const giveItem = document.getElementById('trade-give-item').value;
            const giveAmount = parseInt(document.getElementById('trade-give-amount').value) || 100;
            const getItem = document.getElementById('trade-get-item').value;
            const getAmount = parseInt(document.getElementById('trade-get-amount').value) || 10;
            
            // Check if player has enough to give
            let hasEnough = false;
            
            switch(giveItem) {
                case 'money':
                    hasEnough = currentCountry.economy >= giveAmount;
                    break;
                case 'missiles':
                    hasEnough = currentCountry.equipment.missiles >= giveAmount;
                    break;
                case 'fighters':
                    hasEnough = currentCountry.equipment.fighters >= giveAmount;
                    break;
                case 'tanks':
                    hasEnough = currentCountry.equipment.tanks >= giveAmount;
                    break;
            }
            
            if (!hasEnough) {
                alert(`موارد کافی برای تجارت ندارید!`);
                return;
            }
            
            // Add news (simulating trade acceptance)
            const giveText = getItemText(giveItem, giveAmount);
            const getText = getItemText(getItem, getAmount);
            
            const newNews = {
                id: window.news.length + 1,
                type: "trade",
                country: currentCountry.name,
                title: "تجارت موفق",
                content: `${currentCountry.name} با ${targetCountry.name} تجارت ${giveText} در برابر ${getText} انجام داد.`,
                time: "همین الان"
            };
            
            window.news.unshift(newNews);
            
            // Update player's resources (simulating trade completion)
            switch(giveItem) {
                case 'money':
                    currentCountry.economy -= giveAmount;
                    break;
                case 'missiles':
                    currentCountry.equipment.missiles -= giveAmount;
                    break;
                case 'fighters':
                    currentCountry.equipment.fighters -= giveAmount;
                    break;
                case 'tanks':
                    currentCountry.equipment.tanks -= giveAmount;
                    break;
            }
            
            switch(getItem) {
                case 'money':
                    currentCountry.economy += getAmount;
                    break;
                case 'missiles':
                    currentCountry.equipment.missiles += getAmount;
                    break;
                case 'fighters':
                    currentCountry.equipment.fighters += getAmount;
                    break;
                case 'tanks':
                    currentCountry.equipment.tanks += getAmount;
                    break;
            }
            
            // Update UI
            updateDashboard();
            loadRecentNews();
            
            // Close modal and show success
            closeModal('trade-modal');
            alert(`تجارت با موفقیت انجام شد!`);
        }
        
        // Get item text for display
        function getItemText(item, amount) {
            const texts = {
                'money': `${amount.toLocaleString()} میلیون دلار`,
                'missiles': `${amount.toLocaleString()} موشک`,
                'fighters': `${amount.toLocaleString()} جنگنده`,
                'tanks': `${amount.toLocaleString()} تانک`
            };
            
            return texts[item] || `${amount} ${item}`;
        }
        
        // Show black market
        function showBlackMarket() {
            showSection('black-market');
        }
        
        // Buy from black market
        function buyFromBlackMarket(itemId) {
            const item = window.blackMarketItems.find(i => i.id === itemId);
            
            // Show purchase modal
            const modalContent = document.getElementById('black-market-modal-content');
            modalContent.innerHTML = `
                <p><strong>تجهیزات:</strong> ${item.name}</p>
                <p><strong>قیمت هر واحد:</strong> ${item.price.toLocaleString()} میلیون دلار</p>
                <p><strong>موجودی شما:</strong> ${currentCountry.economy.toLocaleString()} میلیون دلار</p>
                
                <div class="form-group">
                    <label for="black-market-amount">تعداد</label>
                    <input type="number" id="black-market-amount" class="form-control" value="1" min="1" max="100">
                </div>
                
                <p><strong>قیمت کل:</strong> <span id="black-market-total">${item.price}</span> میلیون دلار</p>
                
                <div class="modal-footer">
                    <button class="btn btn-success" onclick="confirmBlackMarketPurchase(${itemId})">خرید</button>
                    <button class="btn btn-warning" onclick="closeModal('black-market-modal')">لغو</button>
                </div>
            `;
            
            // Update total price on input change
            document.getElementById('black-market-amount').addEventListener('input', function() {
                const amount = parseInt(this.value) || 1;
                document.getElementById('black-market-total').textContent = (amount * item.price).toLocaleString();
            });
            
            openModal('black-market-modal');
        }
        
        // Confirm black market purchase
        function confirmBlackMarketPurchase(itemId) {
            const item = window.blackMarketItems.find(i => i.id === itemId);
            const amount = parseInt(document.getElementById('black-market-amount').value) || 1;
            const totalPrice = amount * item.price;
            
            // Check if player has enough money
            if (currentCountry.economy < totalPrice) {
                alert(`پول کافی ندارید! قیمت کل: ${totalPrice.toLocaleString()} میلیون دلار`);
                return;
            }
            
            // Deduct money
            currentCountry.economy -= totalPrice;
            
            // Add equipment
            switch(item.name) {
                case "موشک":
                    currentCountry.equipment.missiles += amount;
                    break;
                case "جنگنده":
                    currentCountry.equipment.fighters += amount;
                    break;
                case "تانک":
                    currentCountry.equipment.tanks += amount;
                    break;
                case "ناو جنگی":
                    currentCountry.equipment.warships += amount;
                    break;
                case "سرباز":
                    currentCountry.equipment.soldiers += amount * 1000;
                    break;
            }
            
            // Add news
            const newNews = {
                id: window.news.length + 1,
                type: "trade",
                country: currentCountry.name,
                title: "خرید از بازار سیاه",
                content: `${currentCountry.name} از بازار سیاه ${amount.toLocaleString()} ${item.name} خریداری کرد.`,
                time: "همین الان"
            };
            
            window.news.unshift(newNews);
            
            // Update UI
            updateDashboard();
            loadRecentNews();
            loadBlackMarketItems();
            
            // Close modal and show success
            closeModal('black-market-modal');
            alert(`خرید با موفقیت انجام شد!`);
        }
        
        // Publish statement
        function publishStatement() {
            const title = document.getElementById('statement-title').value;
            const content = document.getElementById('statement-content').value;
            
            if (!title || !content) {
                alert("لطفا عنوان و متن بیانیه را وارد کنید.");
                return;
            }
            
            // Add news
            const newNews = {
                id: window.news.length + 1,
                type: "statement",
                country: currentCountry.name,
                title: title,
                content: content,
                time: "همین الان"
            };
            
            window.news.unshift(newNews);
            
            // Update UI
            loadRecentNews();
            
            // Clear form
            document.getElementById('statement-title').value = '';
            document.getElementById('statement-content').value = '';
            
            // Show success
            alert("بیانیه با موفقیت منتشر شد!");
            
            // Go to news section
            showSection('news');
        }
        
        // Clear my statements
        function clearMyStatements() {
            if (!currentCountry && !isAdmin) return;
            
            // Filter out statements by current country (or all if admin)
            window.news = window.news.filter(item => {
                if (isAdmin) {
                    // Admin can delete any statement except system messages
                    return item.type === 'system' || !confirm(`آیا از حذف بیانیه "${item.title}" اطمینان دارید؟`);
                } else {
                    // Player can only delete their own statements
                    return item.country !== currentCountry.name || item.type !== 'statement' || 
                           !confirm(`آیا از حذف بیانیه "${item.title}" اطمینان دارید؟`);
                }
            });
            
            // Update UI
            loadRecentNews();
        }
        
        // Delete news item
        function deleteNews(newsId) {
            window.news = window.news.filter(item => item.id !== newsId);
            loadRecentNews();
        }
        
        // Toggle country status
        function toggleCountryStatus() {
            if (!currentCountry) return;
            
            currentCountry.active = !currentCountry.active;
            
            // Update UI
            document.getElementById('status-value').textContent = currentCountry.active ? "فعال" : "غیرفعال";
            document.querySelector('#dashboard-section .btn-warning').textContent = 
                currentCountry.active ? "تغییر وضعیت به غیرفعال" : "تغییر وضعیت به فعال";
            
            // Add news
            const newNews = {
                id: window.news.length + 1,
                type: "system",
                country: "سیستم",
                title: "تغییر وضعیت کشور",
                content: `${currentCountry.name} وضعیت خود را به ${currentCountry.active ? 'فعال' : 'غیرفعال'} تغییر داد.`,
                time: "همین الان"
            };
            
            window.news.unshift(newNews);
            loadRecentNews();
            
            alert(`وضعیت کشور به ${currentCountry.active ? 'فعال' : 'غیرفعال'} تغییر یافت.`);
        }
        
        // Admin functions
        function loadAdminCountries() {
            const container = document.getElementById('admin-countries-list');
            if (!container) return;
            
            container.innerHTML = '';
            
            window.countries.forEach(country => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${country.name}</td>
                    <td>${country.username}</td>
                    <td>${country.economy.toLocaleString()}</td>
                    <td>${country.defense}%</td>
                    <td>${country.technology}</td>
                    <td>
                        <button class="btn btn-info btn-sm" onclick="editCountry(${country.id})" style="margin-left: 5px;">
                            ویرایش
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="deleteCountry(${country.id})" ${country.username === 'iran' ? 'disabled' : ''}>
                            حذف
                        </button>
                    </td>
                `;
                
                container.appendChild(row);
            });
        }
        
        function showAddCountryModal() {
            openModal('add-country-modal');
        }
        
        function addNewCountry() {
            const name = document.getElementById('new-country-name').value;
            const username = document.getElementById('new-country-username').value;
            const password = document.getElementById('new-country-password').value;
            const economy = parseInt(document.getElementById('new-country-economy').value) || 1000000;
            const defense = parseInt(document.getElementById('new-country-defense').value) || 50;
            const technology = parseInt(document.getElementById('new-country-technology').value) || 3;
            
            if (!name || !username || !password) {
                alert("لطفا نام کشور، نام کاربری و رمز عبور را وارد کنید.");
                return;
            }
            
            // Check if username already exists
            if (window.countries.some(c => c.username === username)) {
                alert("این نام کاربری قبلاً استفاده شده است.");
                return;
            }
            
            // Add new country
            const newCountry = {
                id: window.countries.length + 1,
                name: name,
                username: username,
                password: password,
                economy: economy,
                defense: defense,
                technology: technology,
                equipment: {
                    missiles: 100,
                    fighters: 50,
                    bombers: 10,
                    tanks: 200,
                    warships: 20,
                    airDefense: 100000,
                    soldiers: 300000
                },
                active: true,
                production: 70
            };
            
            window.countries.push(newCountry);
            
            // Update UI
            loadAdminCountries();
            
            // Close modal
            closeModal('add-country-modal');
            
            // Clear form
            document.getElementById('new-country-name').value = '';
            document.getElementById('new-country-username').value = '';
            document.getElementById('new-country-password').value = '';
            
            // Show success
            alert(`کشور ${name} با موفقیت اضافه شد.`);
        }
        
        function editCountry(countryId) {
            const country = window.countries.find(c => c.id === countryId);
            if (!country) return;
            
            const modalContent = document.getElementById('edit-country-modal-content');
            modalContent.innerHTML = `
                <div class="form-group">
                    <label for="edit-country-name">نام کشور</label>
                    <input type="text" id="edit-country-name" class="form-control" value="${country.name}">
                </div>
                
                <div class="form-group">
                    <label for="edit-country-username">نام کاربری</label>
                    <input type="text" id="edit-country-username" class="form-control" value="${country.username}">
                </div>
                
                <div class="form-group">
                    <label for="edit-country-password">رمز عبور (برای تغییر وارد کنید)</label>
                    <input type="password" id="edit-country-password" class="form-control" placeholder="رمز عبور جدید">
                </div>
                
                <div class="form-group">
                    <label for="edit-country-economy">اقتصاد (میلیون دلار)</label>
                    <input type="number" id="edit-country-economy" class="form-control" value="${country.economy}">
                </div>
                
                <div class="form-group">
                    <label for="edit-country-defense">درصد دفاع</label>
                    <input type="number" id="edit-country-defense" class="form-control" min="0" max="100" value="${country.defense}">
                </div>
                
                <div class="form-group">
                    <label for="edit-country-technology">سطح فناوری</label>
                    <input type="number" id="edit-country-technology" class="form-control" min="1" max="10" value="${country.technology}">
                </div>
                
                <div class="modal-footer">
                    <button class="btn btn-success" onclick="saveCountryChanges(${countryId})">ذخیره تغییرات</button>
                    <button class="btn btn-warning" onclick="closeModal('edit-country-modal')">لغو</button>
                </div>
            `;
            
            openModal('edit-country-modal');
        }
        
        function saveCountryChanges(countryId) {
            const country = window.countries.find(c => c.id === countryId);
            if (!country) return;
            
            country.name = document.getElementById('edit-country-name').value;
            country.username = document.getElementById('edit-country-username').value;
            
            const newPassword = document.getElementById('edit-country-password').value;
            if (newPassword) {
                country.password = newPassword;
            }
            
            country.economy = parseInt(document.getElementById('edit-country-economy').value) || country.economy;
            country.defense = parseInt(document.getElementById('edit-country-defense').value) || country.defense;
            country.technology = parseInt(document.getElementById('edit-country-technology').value) || country.technology;
            
            // Update UI
            loadAdminCountries();
            
            // Close modal
            closeModal('edit-country-modal');
            
            // Show success
            alert(`تغییرات کشور ${country.name} ذخیره شد.`);
        }
        
        function deleteCountry(countryId) {
            if (!confirm("آیا از حذف این کشور اطمینان دارید؟ این عمل غیرقابل بازگشت است.")) {
                return;
            }
            
            // Don't delete Iran (demo protection)
            const country = window.countries.find(c => c.id === countryId);
            if (country.username === 'iran') {
                alert("نمی‌توانید کشور ایران را حذف کنید.");
                return;
            }
            
            // Remove country
            window.countries = window.countries.filter(c => c.id !== countryId);
            
            // Update UI
            loadAdminCountries();
            
            // Show success
            alert(`کشور حذف شد.`);
        }
        
        function toggleSystemStatus() {
            gameActive = !gameActive;
            
            // Update UI
            document.getElementById('system-status').textContent = gameActive ? "فعال" : "غیرفعال";
            
            // Update button text
            document.querySelector('#admin-controls-section .btn-warning').textContent = 
                gameActive ? "غیرفعال کردن سیستم" : "فعال کردن سیستم";
            
            // Add news
            const newNews = {
                id: window.news.length + 1,
                type: "system",
                country: "سیستم",
                title: "تغییر وضعیت سیستم",
                content: `سیستم بازی به وضعیت ${gameActive ? 'فعال' : 'غیرفعال'} تغییر یافت.`,
                time: "همین الان"
            };
            
            window.news.unshift(newNews);
            loadRecentNews();
            
            alert(`وضعیت سیستم به ${gameActive ? 'فعال' : 'غیرفعال'} تغییر یافت.`);
        }
        
        function sendSystemMessage() {
            const message = document.getElementById('system-message').value;
            
            if (!message) {
                alert("لطفا پیام سیستم را وارد کنید.");
                return;
            }
            
            // Add news
            const newNews = {
                id: window.news.length + 1,
                type: "system",
                country: "سیستم",
                title: "پیام سیستم",
                content: message,
                time: "همین الان"
            };
            
            window.news.unshift(newNews);
            
            // Update UI
            loadRecentNews();
            
            // Clear input
            document.getElementById('system-message').value = '';
            
            // Show success
            alert("پیام سیستم ارسال شد.");
        }
        
        // Modal functions
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // Initialize the game when page loads
        window.onload = initGame;
    </script>
</body>
</html>